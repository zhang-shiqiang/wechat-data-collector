# 微信公众号管理阅读器 - 需求计划文档

## 一、项目概述

### 1.1 项目背景
用户需要一款微信公众号管理阅读器，解决微信原生推送逻辑不符合个人需求的问题。该工具旨在帮助用户更好地分类管理关注的公众号，统一阅读文章，并按照个人习惯进行管理。

### 1.2 项目目标
- 提供自定义分类管理公众号的功能
- 统一聚合展示公众号文章
- 支持按个人习惯进行阅读和管理
- 不依赖微信的推送逻辑，用户自主控制阅读节奏
- **全平台支持：** 适配手机、平板、电脑等不同设备，提供一致的用户体验
- **多用户支持：** 完整的用户体系，支持多用户独立使用

### 1.3 目标用户
- 关注大量公众号的用户
- 对微信推送逻辑不满意的用户
- 需要按分类阅读文章的用户
- 希望统一管理公众号内容的用户
- **跨设备用户：** 需要在手机、平板、电脑等多设备上使用的用户
- **企业用户：** 需要团队协作和批量管理的用户（未来扩展）

## 二、功能需求

### 2.1 核心功能模块

#### 2.1.1 用户体系模块
**功能描述：** 用户注册、登录、权限管理

**详细需求：**
- [ ] 用户注册
  - 邮箱注册
  - 手机号注册（可选）
  - 第三方登录（微信、GitHub等，可选）
  - 邮箱验证
  - 密码强度验证
- [ ] 用户登录
  - 邮箱/手机号 + 密码登录
  - 记住登录状态
  - 登录失败次数限制
  - 验证码验证（可选）
- [ ] 用户信息管理
  - 个人资料编辑（昵称、头像、邮箱等）
  - 密码修改
  - 邮箱绑定/解绑
  - 手机号绑定/解绑
- [ ] 用户权限管理
  - 角色定义（普通用户、管理员）
  - 功能访问限制
- [ ] 账户安全
  - 登录日志记录
  - 异常登录提醒
  - 设备管理（查看登录设备、踢出设备）
  - 两步验证（可选）

#### 2.1.2 公众号管理模块
**功能描述：** 管理用户关注的公众号列表

**详细需求：**
- [ ] 添加公众号
  - 支持通过公众号名称搜索添加
  - 支持通过公众号ID/微信号添加
  - 支持手动输入公众号信息
  - 支持批量导入公众号
- [ ] 公众号列表展示
  - 显示公众号头像、名称、简介
  - 显示文章更新数量（未读/总数）
  - 显示最后更新时间
  - 支持列表/卡片两种展示方式
  - **移动端适配：**
    - 网格布局（移动端，2列）
    - 列表布局（桌面端，详细信息）
    - 长按菜单（移动端）
    - 滑动操作（移动端）
- [ ] 公众号信息编辑
  - 修改公众号名称（自定义别名）
  - 修改分类归属
  - 设置更新频率
  - 启用/禁用抓取
  - **配置抓取过滤条件：**
    - 设置作者过滤（只抓取指定作者的文章）
    - 设置标题关键词过滤（只抓取标题包含关键词的文章）
    - 设置匹配模式（模糊/精确/正则）
    - 设置日期范围过滤
- [ ] 公众号删除
  - 单个删除
  - 批量删除
  - 删除确认提示

#### 2.1.3 分类管理模块
**功能描述：** 用户自定义分类体系，管理公众号和文章

**详细需求：**
- [ ] 分类创建
  - 创建一级分类
  - 创建多级分类（支持子分类）
  - 设置分类名称、图标、颜色
  - 设置分类排序
- [ ] 分类编辑
  - 修改分类名称
  - 修改分类层级关系
  - 调整分类顺序
  - 修改分类样式（图标、颜色）
- [ ] 分类删除
  - 删除分类（需处理分类下的公众号和文章）
  - 支持合并到其他分类
- [ ] 分类统计
  - 显示每个分类下的公众号数量
  - 显示每个分类下的文章数量（未读/总数）
- [ ] 默认分类
  - 提供"未分类"默认分类
  - 支持设置默认分类规则

#### 2.1.4 文章抓取模块
**功能描述：** 自动或手动从公众号抓取文章

**详细需求：**
- [ ] 抓取方式
  - 自动定时抓取（可设置抓取频率）
  - 手动触发抓取
  - 单个公众号抓取
  - 批量公众号抓取
- [ ] 抓取策略
  - 支持RSS订阅（如果公众号支持）
  - 支持网页爬虫抓取
  - 支持API接口获取（如果可用）
  - 增量抓取（只抓取新文章）
  - **多维度数据获取：**
    - 按作者过滤抓取（只抓取指定作者的文章）
    - 按公众号名称过滤抓取（只抓取指定公众号的文章）
    - 按文章名称/标题关键词过滤抓取（只抓取标题包含特定关键词的文章）
    - 多维度组合过滤（作者+公众号+文章名称组合条件）
    - 支持模糊匹配和精确匹配
    - 支持正则表达式匹配（可选）
- [ ] 抓取内容
  - 文章标题
  - 文章正文内容
  - 文章发布时间
  - 文章封面图
  - 文章摘要
  - 文章链接
  - 作者信息
- [ ] 抓取状态管理
  - 显示抓取进度
  - 抓取失败重试机制
  - 抓取日志记录
  - 抓取错误通知

#### 2.1.5 文章阅读模块
**功能描述：** 文章列表展示和详情阅读

**详细需求：**
- [ ] 文章列表
  - 按分类展示文章
  - 按公众号展示文章
  - 按时间排序（最新/最旧）
  - 按阅读状态筛选（已读/未读/全部）
  - 支持搜索文章（标题、内容）
  - **多维度筛选：**
    - 按作者筛选
    - 按公众号名称筛选
    - 按文章名称/标题筛选
    - 多条件组合筛选（作者+公众号+文章名称）
    - 支持模糊匹配和精确匹配
  - 支持标签筛选
  - 分页加载
  - **移动端适配：**
    - 下拉刷新（移动端）
    - 上拉加载更多（移动端）
    - 虚拟滚动优化（长列表性能）
    - 卡片式布局（移动端）/ 列表式布局（桌面端）
    - 滑动操作（左滑删除、右滑收藏）
- [ ] 文章卡片
  - 显示文章标题
  - 显示文章封面图
  - 显示文章摘要
  - 显示发布时间
  - 显示来源公众号
  - 显示阅读状态标识
  - 显示分类标签
- [ ] 文章详情
  - 文章正文展示（支持Markdown/HTML）
  - 文章元信息（发布时间、作者、来源）
  - 阅读进度记录
  - 字体大小调整
  - 夜间模式
  - 阅读时间估算
  - **移动端适配：**
    - 全屏阅读模式（移动端）
    - 横屏阅读优化
    - 触摸滑动翻页（可选）
    - 底部操作栏（移动端，固定底部）
    - 顶部导航栏自动隐藏（滚动时）
- [ ] 阅读操作
  - 标记已读/未读
  - 收藏/取消收藏
  - 分享文章
  - 跳转到原文
  - 删除文章

#### 2.1.6 搜索功能模块
**功能描述：** 全文搜索文章和公众号

**详细需求：**
- [ ] 搜索范围
  - 搜索文章标题
  - 搜索文章内容
  - 搜索公众号名称
  - 搜索分类名称
  - **搜索作者名称**
- [ ] 搜索功能
  - 实时搜索建议
  - 搜索历史记录
  - **多维度高级搜索：**
    - 按作者搜索
    - 按公众号名称搜索
    - 按文章名称/标题搜索
    - 多维度组合搜索（作者+公众号+文章名称+时间范围+分类）
    - 支持模糊匹配和精确匹配
    - 支持正则表达式搜索（可选）
  - 高级搜索（时间范围、分类、公众号）
  - 搜索结果高亮
  - 搜索结果排序
  - **搜索结果统计：** 显示各维度匹配数量

#### 2.1.7 用户设置模块
**功能描述：** 用户偏好设置和系统配置

**详细需求：**
- [ ] 阅读设置
  - 默认字体大小
  - 默认字体类型
  - 行间距设置
  - 夜间模式开关
  - 自动标记已读时间
- [ ] 抓取设置
  - 默认抓取频率
  - 抓取时间范围（只抓取最近N天的文章）
  - 抓取失败重试次数
  - 抓取通知设置
  - **多维度抓取过滤设置：**
    - 默认作者过滤（可选）
    - 默认标题关键词过滤（可选）
    - 默认匹配模式（模糊/精确/正则）
    - 按公众号配置抓取过滤条件
- [ ] 分类设置
  - 默认分类规则
  - 新公众号默认分类
- [ ] 数据管理
  - 数据导出（导出文章、公众号列表）
  - 数据备份
  - 数据恢复
  - 清空数据

### 2.2 辅助功能模块

#### 2.2.1 统计面板
- [ ] 总公众号数量
- [ ] 总文章数量
- [ ] 未读文章数量
- [ ] 今日新增文章
- [ ] 阅读时长统计
- [ ] 分类分布统计
- [ ] 阅读趋势图表

#### 2.2.2 通知提醒
- [ ] 新文章通知
- [ ] 抓取失败通知
- [ ] 系统更新通知

#### 2.2.3 数据导入导出
- [ ] 导入公众号列表（CSV/JSON）
- [ ] 导出文章（Markdown/PDF）
- [ ] 导出阅读记录

## 三、非功能需求

### 3.1 性能需求

#### 3.1.1 通用性能
- 文章列表加载时间 < 2秒
- 文章详情加载时间 < 1秒
- 支持10,000+文章数据
- 支持100+公众号管理
- 抓取任务并发数可配置

#### 3.1.2 移动端性能
- 首屏加载时间 < 3秒（移动网络）
- 页面切换动画流畅（60fps）
- 长列表滚动流畅（虚拟滚动）
- 图片加载优化（懒加载、WebP格式）
- 减少移动端数据流量消耗

#### 3.1.3 桌面端性能
- 首屏加载时间 < 2秒
- 支持大量数据展示（10,000+文章）
- 多标签页切换流畅
- 快捷键响应时间 < 100ms

### 3.2 安全需求
- 用户数据本地加密存储
- 抓取请求频率限制（避免被封）
- 敏感信息脱敏处理
- 数据备份加密

### 3.3 兼容性需求（全平台适配）

#### 3.3.1 设备支持
- **手机端：** iOS Safari、Android Chrome、微信内置浏览器
  - 屏幕尺寸：320px - 768px
  - 支持横屏和竖屏切换
  - 触摸操作优化
- **平板端：** iPad、Android 平板
  - 屏幕尺寸：768px - 1024px
  - 支持横屏和竖屏切换
  - 触摸和鼠标操作
- **桌面端：** Windows、macOS、Linux
  - 屏幕尺寸：1024px+
  - 支持多窗口、多标签页
  - 键盘快捷键支持

#### 3.3.2 浏览器兼容
- **桌面浏览器：** Chrome 90+、Firefox 88+、Safari 14+、Edge 90+
- **移动浏览器：** iOS Safari 14+、Android Chrome 90+
- **微信浏览器：** 微信内置浏览器（iOS/Android）

#### 3.3.3 响应式设计
- 采用移动优先（Mobile First）设计策略
- 支持断点自适应：
  - 手机：< 768px
  - 平板：768px - 1024px
  - 桌面：> 1024px
- 布局自适应：导航栏、侧边栏、内容区域根据屏幕尺寸调整
- 字体大小自适应：根据设备像素比和屏幕尺寸调整
- 图片响应式：支持不同分辨率图片加载

### 3.4 可用性需求

#### 3.4.1 通用可用性
- 界面简洁直观
- 操作流程清晰
- 错误提示友好
- 加载状态提示

#### 3.4.2 桌面端特性
- 支持键盘快捷键操作
- 支持鼠标悬停效果
- 支持拖拽操作（如分类排序）
- 支持右键菜单

#### 3.4.3 移动端特性
- 触摸手势支持（滑动、长按、下拉刷新）
- 底部导航栏（移动端）
- 侧边栏抽屉式导航
- 下拉刷新和上拉加载
- 触摸反馈（震动、动画）
- 防止误触设计

### 3.5 可维护性需求
- 代码结构清晰
- 完善的日志系统
- 错误监控和报告
- 文档完善

### 3.6 响应式布局设计规范

#### 3.6.1 断点定义
- **手机端（Mobile）：** < 768px
  - 单列布局
  - 底部导航栏
  - 侧边栏抽屉式
  - 触摸操作优化
- **平板端（Tablet）：** 768px - 1024px
  - 双列布局（可选）
  - 侧边栏可折叠
  - 触摸和鼠标操作
- **桌面端（Desktop）：** > 1024px
  - 多列布局
  - 固定侧边栏
  - 鼠标和键盘操作

#### 3.6.2 布局方案
- **导航栏：**
  - 手机端：底部导航栏（固定底部）
  - 平板端：侧边栏导航（可折叠）
  - 桌面端：顶部导航栏 + 左侧边栏
- **内容区域：**
  - 手机端：全宽单列
  - 平板端：主内容区 + 可选侧边栏
  - 桌面端：主内容区 + 侧边栏 + 可选右侧栏
- **文章列表：**
  - 手机端：卡片式，单列，2-3个卡片高度
  - 平板端：卡片式，双列
  - 桌面端：列表式或卡片式，多列

#### 3.6.3 交互适配
- **手机端：**
  - 触摸手势（滑动、长按、下拉刷新）
  - 大按钮设计（最小44x44px）
  - 底部操作栏（固定）
  - 全屏阅读模式
- **平板端：**
  - 触摸和鼠标混合操作
  - 中等尺寸按钮
  - 可折叠侧边栏
- **桌面端：**
  - 鼠标悬停效果
  - 键盘快捷键
  - 拖拽操作
  - 右键菜单

## 四、技术需求

### 4.1 前端技术栈

#### 4.1.1 核心框架
- **框架：** React 18
- **构建工具：** Vite（推荐，支持快速热更新）
- **语言：** TypeScript（推荐，提供类型安全）
- **路由：** React Router v6
- **状态管理：** Zustand（轻量级） / Redux Toolkit（复杂状态）

#### 4.1.2 UI组件库（已选定：Ant Design）
- **选定方案：** Ant Design + Ant Design Mobile
  - **桌面端：** Ant Design（企业级UI设计，美观现代）
  - **移动端：** Ant Design Mobile（专为移动端优化）
  - **优势：**
    - 设计美观，符合现代审美
    - 组件丰富，开箱即用
    - 统一设计语言，桌面和移动端无缝切换
    - 中文文档完善，开发效率高
    - 响应式支持良好
    - 主题定制灵活

#### 4.1.3 响应式设计工具
- **CSS框架：** Tailwind CSS（推荐，内置响应式工具类）
- **CSS预处理器：** SCSS / Less
- **CSS-in-JS：** styled-components / emotion
- **响应式工具：** react-responsive / use-media-query
- **布局组件：** react-grid-system / react-flexbox-grid

#### 4.1.4 移动端增强
- **触摸手势：** react-swipeable / react-gesture-handler
- **下拉刷新：** react-pull-to-refresh
- **虚拟滚动：** react-window / react-virtualized（长列表优化）
- **PWA支持：** workbox / vite-plugin-pwa（可选，支持离线访问）

#### 4.1.5 其他工具
- **HTTP客户端：** Axios
- **表单处理：** React Hook Form
- **日期处理：** dayjs / date-fns
- **图标库：** @ant-design/icons / react-icons
- **工具函数：** lodash-es

### 4.2 后端技术栈（Python + FastAPI）

**技术选型说明：** 后端采用 Python 作为主要开发语言，选择 Python 的优势：
- **生态丰富：** Python 拥有丰富的第三方库，特别适合爬虫、数据处理、AI对接
- **开发效率高：** 语法简洁，开发速度快
- **易于对接：** 便于对接扣子平台等 AI 平台（Python SDK 支持完善）
- **异步支持：** Python 3.10+ 的异步特性完善，适合高并发场景
- **社区活跃：** 问题解决快，文档完善

#### 4.2.1 核心框架
- **语言：** Python 3.10+（推荐 3.11+）
- **框架：** FastAPI（高性能，自动API文档，类型提示）
- **ASGI服务器：** Uvicorn（高性能异步服务器）
- **API文档：** 自动生成（Swagger/OpenAPI）
- **Python版本管理：** pyenv / poetry（推荐使用 poetry 管理依赖）

#### 4.2.2 爬虫相关
- **浏览器自动化：** Playwright（推荐）/ Selenium
- **HTTP请求：** httpx / requests
- **HTML解析：** BeautifulSoup4 / lxml
- **RSS订阅：** feedparser

#### 4.2.3 任务和队列
- **定时任务：** APScheduler（推荐）/ Celery
- **任务队列：** Celery + Redis / RQ（Redis Queue）
- **异步任务：** FastAPI BackgroundTasks / Celery

#### 4.2.4 数据处理
- **ORM：** SQLAlchemy / Tortoise ORM（异步）
- **数据库迁移：** Alembic
- **数据验证：** Pydantic（FastAPI内置）

#### 4.2.5 认证和授权
- **JWT认证：** python-jose[cryptography]（JWT token生成和验证）
- **密码加密：** passlib[bcrypt]（密码哈希）
- **OAuth2：** python-multipart（FastAPI OAuth2支持）
- **权限管理：** 自定义权限中间件

#### 4.2.6 其他工具
- **环境变量：** python-dotenv
- **日志：** loguru（推荐，更友好）/ Python logging
- **HTTP客户端：** httpx（异步支持，推荐）
- **日期处理：** python-dateutil
- **工具函数：** more-itertools
- **API限流：** slowapi（FastAPI限流中间件）
- **重试机制：** tenacity
- **邮件发送：** aiosmtplib / fastapi-mail（邮箱验证）
- **短信发送：** 阿里云短信SDK / 腾讯云短信SDK（可选）

### 4.3 数据库
- **主数据库：** PostgreSQL
- **缓存：** Redis
- **全文搜索：** PostgreSQL全文搜索 / Meilisearch

### 4.4 数据获取方案
- **RSS订阅：** feedparser（Python）
- **网页爬虫：** Playwright + BeautifulSoup4
- **API接口：** 微信开放平台 / 扣子平台API（后续对接）

### 4.5 部署方案
- **容器化：** Docker + Docker Compose
- **CI/CD：** GitHub Actions
- **服务器：** 云服务器（阿里云/腾讯云）

### 4.6 推荐技术栈组合（全平台适配）

#### 方案一：React + Ant Design + FastAPI（推荐，全平台）
```
前端：
  - React 18 + TypeScript + Vite
  - Ant Design（桌面端）+ Ant Design Mobile（移动端）
  - Tailwind CSS（响应式设计）
  - Zustand（状态管理）
  - React Router v6（路由）
  - react-responsive（响应式检测）
  - react-window（虚拟滚动，长列表优化）
  - react-swipeable（触摸手势）

后端：
  - Python 3.10+ + FastAPI
  - Playwright（浏览器自动化）
  - BeautifulSoup4（HTML解析）
  - SQLAlchemy（ORM）
  - APScheduler（定时任务）
  - Celery + Redis（任务队列）
  - httpx（HTTP客户端）

数据库：PostgreSQL + Redis
部署：Docker + Docker Compose
```

#### 方案二：React + Ant Design + FastAPI（轻量级）
```
前端：
  - React 18 + TypeScript + Vite
  - Ant Design + Ant Design Mobile
  - Zustand（状态管理）
  - React Router v6（路由）

后端：
  - Python 3.10+ + FastAPI
  - Playwright + BeautifulSoup4
  - SQLAlchemy
  - APScheduler
  - FastAPI BackgroundTasks（轻量级任务）

数据库：SQLite + Redis（开发环境）
部署：Docker
```

### 4.7 扣子平台API对接准备

#### 4.7.1 对接优势
- FastAPI天然支持异步，适合对接外部API
- 自动生成API文档，便于调试和对接
- 类型提示完善，减少对接错误
- 高性能，支持高并发请求

#### 4.7.2 对接方案
- **HTTP客户端：** httpx（异步，性能好）
- **API认证：** OAuth2 / API Key（根据扣子平台要求）
- **请求重试：** tenacity（Python重试库）
- **限流控制：** slowapi（FastAPI限流中间件）
- **错误处理：** 统一异常处理机制
- **日志记录：** 记录所有API调用日志

## 五、开发计划

### 5.1 开发阶段划分

#### 第一阶段：项目搭建与基础功能（2周）
**目标：** 完成项目基础架构和核心功能框架

**任务清单：**
- [ ] 项目初始化
  - [ ] 前端项目搭建（React 18 + Vite + TypeScript + Ant Design）
  - [ ] 后端项目搭建（Python 3.10+ + FastAPI）
    - [ ] Python 虚拟环境配置（venv / poetry）
    - [ ] FastAPI 项目结构搭建
    - [ ] 依赖管理配置（requirements.txt / poetry）
    - [ ] 开发环境配置（.env 文件管理）
  - [ ] 数据库设计和创建（PostgreSQL）
    - [ ] 数据表结构设计
    - [ ] **多维度查询索引设计：**
      - [ ] 文章表索引（author, title, 组合索引）
      - [ ] 公众号表索引（name）
      - [ ] 全文搜索索引配置
  - [ ] Docker环境配置（Python 环境）
  - [ ] 前后端API接口定义
- [ ] 用户体系开发
  - [ ] 用户注册/登录功能（JWT认证）
  - [ ] 用户信息管理
  - [ ] 邮箱验证功能
  - [ ] 密码重置功能
  - [ ] 登录日志记录
  - [ ] 权限中间件开发
- [ ] 基础功能开发
  - [ ] 公众号管理基础功能（添加、列表、删除，需用户隔离）
  - [ ] 分类管理基础功能（创建、编辑、删除，需用户隔离）
  - [ ] 基础UI框架搭建
  - [ ] 用户中心页面
- [ ] 响应式设计基础
  - [ ] 响应式布局框架搭建
  - [ ] 断点系统配置（手机/平板/桌面）
  - [ ] 基础组件响应式适配
  - [ ] 导航栏响应式（桌面端顶部导航，移动端底部导航/侧边栏）

**交付物：**
- 可运行的项目框架
- 基础的公众号和分类管理功能

#### 第二阶段：文章抓取功能（2周）
**目标：** 实现文章抓取核心功能

**任务清单：**
- [ ] 抓取引擎开发
  - [ ] RSS订阅功能（feedparser）
  - [ ] 网页爬虫功能（Playwright）
  - [ ] 文章内容解析（BeautifulSoup4）
  - [ ] 图片下载和存储
  - [ ] **多维度数据获取功能：**
    - [ ] 按作者过滤抓取逻辑
    - [ ] 按公众号名称过滤抓取逻辑
    - [ ] 按文章标题关键词过滤抓取逻辑
    - [ ] 多维度组合过滤逻辑
    - [ ] 模糊匹配和精确匹配实现
    - [ ] 正则表达式匹配支持（可选）
- [ ] 抓取任务管理
  - [ ] 定时任务系统（APScheduler）
  - [ ] 任务队列管理（Celery + Redis）
  - [ ] 抓取进度跟踪
  - [ ] 错误处理和重试
  - [ ] **抓取过滤条件管理：**
    - [ ] 过滤条件配置和存储
    - [ ] 过滤条件应用到抓取任务
- [ ] 数据存储
  - [ ] 文章数据模型设计
  - [ ] 文章存储逻辑
  - [ ] 增量抓取逻辑
  - [ ] **抓取过滤条件数据模型设计**

**交付物：**
- 可用的文章抓取功能
- 定时抓取任务系统

#### 第三阶段：文章阅读功能（1.5周）
**目标：** 实现文章展示和阅读功能

**任务清单：**
- [ ] 文章列表功能
  - [ ] 列表展示（分类/公众号/全部）
  - [ ] 筛选和排序
  - [ ] **多维度筛选功能：**
    - [ ] 按作者筛选
    - [ ] 按公众号名称筛选
    - [ ] 按文章名称/标题筛选
    - [ ] 多条件组合筛选（作者+公众号+文章名称）
    - [ ] 模糊匹配和精确匹配支持
  - [ ] 搜索功能
  - [ ] **多维度搜索功能：**
    - [ ] 作者搜索
    - [ ] 公众号名称搜索
    - [ ] 文章标题搜索
    - [ ] 多维度组合搜索
    - [ ] 搜索结果高亮和统计
  - [ ] 分页加载
- [ ] 文章详情功能
  - [ ] 文章详情页
  - [ ] 阅读状态管理
  - [ ] 收藏功能
  - [ ] 阅读设置（字体、夜间模式）
- [ ] 阅读体验优化
  - [ ] 阅读进度记录
  - [ ] 阅读时间估算
  - [ ] 文章样式优化
- [ ] 移动端适配
  - [ ] 移动端布局优化
  - [ ] 触摸手势支持（滑动、长按）
  - [ ] 下拉刷新和上拉加载
  - [ ] 移动端导航优化（底部导航栏）
  - [ ] 移动端文章阅读体验优化
  - [ ] 横屏适配

**交付物：**
- 完整的文章阅读功能
- 良好的阅读体验

#### 第四阶段：高级功能和优化（1.5周）
**目标：** 完善功能，优化体验

**任务清单：**
- [ ] 统计面板
  - [ ] 数据统计功能
  - [ ] 图表展示
- [ ] 用户设置
  - [ ] 阅读设置
  - [ ] 抓取设置
  - [ ] 数据管理（导入导出）
- [ ] 性能优化
  - [ ] 列表虚拟滚动
  - [ ] 图片懒加载
  - [ ] 数据缓存优化
  - [ ] 移动端性能优化（减少重绘、优化动画）
- [ ] 跨平台测试和优化
  - [ ] 手机端测试（iOS/Android）
  - [ ] 平板端测试（iPad/Android平板）
  - [ ] 桌面端测试（Windows/macOS/Linux）
  - [ ] 不同浏览器兼容性测试
  - [ ] 响应式布局细节调整
  - [ ] 触摸交互优化
  - [ ] 键盘快捷键测试（桌面端）
- [ ] 错误处理和日志
  - [ ] 错误监控
  - [ ] 日志系统
  - [ ] 用户反馈机制

**交付物：**
- 功能完善的应用
- 性能优化的版本

#### 第五阶段：测试和部署（1周）
**目标：** 测试、修复问题、部署上线

**任务清单：**
- [ ] 功能测试
  - [ ] 单元测试
  - [ ] 集成测试
  - [ ] 用户测试
- [ ] Bug修复
  - [ ] 修复测试发现的问题
  - [ ] 性能问题优化
- [ ] 部署准备
  - [ ] 生产环境配置
  - [ ] Docker镜像构建
  - [ ] 部署文档编写
- [ ] 上线部署
  - [ ] 服务器部署
  - [ ] 域名配置
  - [ ] SSL证书配置

**交付物：**
- 可用的生产版本
- 部署文档

### 5.2 开发时间估算

| 阶段 | 时间 | 累计时间 |
|------|------|----------|
| 第一阶段：项目搭建与基础功能（含用户体系） | 2.5周 | 2.5周 |
| 第二阶段：文章抓取功能 | 2周 | 4.5周 |
| 第三阶段：文章阅读功能 | 1.5周 | 6周 |
| 第四阶段：高级功能和优化 | 1.5周 | 7.5周 |
| 第五阶段：测试和部署 | 1周 | 8.5周 |

**总计：** 约8.5周（2个月）

### 5.3 里程碑

- **M1：** 项目框架完成，用户体系基础功能可用（第2.5周末）
- **M2：** 文章抓取功能完成（第4.5周末）
- **M3：** 文章阅读功能完成（第6周末）
- **M4：** 功能完善，准备上线（第7.5周末）
- **M5：** 正式上线（第8.5周末）

## 六、数据库设计

### 6.1 核心数据表

#### 6.1.1 用户表 (users)
```sql
- id: 主键
- email: 邮箱（唯一）
- phone: 手机号（可选，唯一）
- username: 用户名（唯一）
- nickname: 昵称
- avatar: 头像URL
- password_hash: 密码哈希
- email_verified: 邮箱是否验证
- phone_verified: 手机号是否验证
- status: 账户状态（active/inactive/banned）
- role: 角色（user/admin）
- last_login_at: 最后登录时间
- last_login_ip: 最后登录IP
- created_at: 创建时间
- updated_at: 更新时间
```

#### 6.1.2 用户登录日志表 (user_login_logs)
```sql
- id: 主键
- user_id: 用户ID（外键）
- ip_address: IP地址
- user_agent: 用户代理
- device_type: 设备类型（mobile/tablet/desktop）
- login_status: 登录状态（success/failed）
- failure_reason: 失败原因（如有）
- created_at: 创建时间
```

#### 6.1.3 公众号表 (wechat_accounts)
```sql
- id: 主键
- user_id: 用户ID（外键）
- name: 公众号名称
- alias: 用户自定义别名
- wechat_id: 微信号/ID
- avatar: 头像URL
- description: 简介
- category_id: 分类ID（外键）
- rss_url: RSS订阅地址（可选）
- fetch_url: 抓取URL
- fetch_method: 抓取方式（rss/crawl/api）
- fetch_enabled: 是否启用抓取
- fetch_frequency: 抓取频率（小时）
- last_fetch_time: 最后抓取时间
- **fetch_filters: 抓取过滤条件（JSON）**
  - author: 作者名称（可选）
  - title_keywords: 文章标题关键词（可选）
  - match_mode: 匹配模式（fuzzy/exact/regex）
  - date_range: 日期范围（可选）
- article_count: 文章总数
- unread_count: 未读文章数
- created_at: 创建时间
- updated_at: 更新时间
```

#### 6.1.4 分类表 (categories)
```sql
- id: 主键
- user_id: 用户ID（外键）
- name: 分类名称
- icon: 图标
- color: 颜色
- parent_id: 父分类ID（支持多级分类）
- sort_order: 排序
- account_count: 公众号数量
- article_count: 文章数量
- created_at: 创建时间
- updated_at: 更新时间
```

#### 6.1.5 文章表 (articles)
```sql
- id: 主键
- user_id: 用户ID（外键）
- account_id: 公众号ID（外键）
- category_id: 分类ID（外键，冗余字段，便于查询）
- title: 文章标题
- content: 文章正文（HTML/Markdown）
- summary: 文章摘要
- cover_image: 封面图URL
- original_url: 原文链接
- publish_time: 发布时间
- author: 作者
- read_status: 阅读状态（unread/read）
- is_favorite: 是否收藏
- read_progress: 阅读进度（0-100）
- read_time: 阅读时间（分钟）
- created_at: 创建时间
- updated_at: 更新时间
```

#### 6.1.6 抓取任务表 (fetch_tasks)
```sql
- id: 主键
- account_id: 公众号ID（外键，可选）
- account_name: 公众号名称（可选，用于按名称过滤）
- task_type: 任务类型（auto/manual）
- status: 任务状态（pending/running/success/failed）
- progress: 进度（0-100）
- fetched_count: 抓取文章数量
- **fetch_filters: 抓取过滤条件（JSON）**
  - author: 作者名称（可选）
  - title_keywords: 文章标题关键词（可选）
  - match_mode: 匹配模式（fuzzy/exact/regex）
  - date_range: 日期范围（可选）
- error_message: 错误信息
- started_at: 开始时间
- completed_at: 完成时间
- created_at: 创建时间
```

#### 6.1.7 用户设置表 (user_settings)
```sql
- id: 主键
- user_id: 用户ID（外键）
- key: 设置键
- value: 设置值（JSON）
- created_at: 创建时间
- updated_at: 更新时间
```

### 6.2 索引设计
- users表：email（唯一）, phone（唯一）, username（唯一）
- articles表：
  - 基础索引：account_id, category_id, user_id, publish_time, read_status
  - **多维度查询索引：**
    - author（作者索引，支持作者筛选）
    - title（标题索引，支持标题搜索和筛选）
    - user_id + author（组合索引，支持用户+作者查询）
    - user_id + title（组合索引，支持用户+标题查询）
    - user_id + account_id + publish_time（组合索引，支持多维度排序）
    - 全文搜索索引：title, content, summary（PostgreSQL全文搜索）
- wechat_accounts表：
  - 基础索引：user_id, category_id, fetch_enabled
  - **名称搜索索引：** name（公众号名称索引，支持名称搜索）
- categories表：user_id, parent_id

## 七、API设计

### 7.1 用户认证API
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `POST /api/auth/refresh` - 刷新Token
- `POST /api/auth/forgot-password` - 忘记密码
- `POST /api/auth/reset-password` - 重置密码
- `POST /api/auth/verify-email` - 验证邮箱
- `GET /api/auth/me` - 获取当前用户信息

### 7.2 用户管理API
- `GET /api/users/profile` - 获取用户资料
- `PUT /api/users/profile` - 更新用户资料
- `PUT /api/users/password` - 修改密码
- `GET /api/users/devices` - 获取登录设备列表
- `DELETE /api/users/devices/:id` - 踢出设备
- `GET /api/users/login-logs` - 获取登录日志

### 7.3 公众号管理API
- `GET /api/accounts` - 获取公众号列表
- `POST /api/accounts` - 添加公众号
- `GET /api/accounts/:id` - 获取公众号详情
- `PUT /api/accounts/:id` - 更新公众号信息
  - 请求参数（可选）：
    - `name`: 公众号名称
    - `alias`: 自定义别名
    - `category_id`: 分类ID
    - `fetch_frequency`: 抓取频率
    - `fetch_enabled`: 是否启用抓取
    - **`fetch_filters`: 抓取过滤条件（JSON）**
      - `author`: 作者名称（可选）
      - `title_keywords`: 文章标题关键词（可选）
      - `match_mode`: 匹配模式（fuzzy/exact/regex）
      - `date_range`: 日期范围（可选）
- `DELETE /api/accounts/:id` - 删除公众号
- `POST /api/accounts/:id/fetch` - 手动抓取公众号文章
  - 请求参数：
    - `author`: 作者名称（可选，只抓取指定作者的文章）
    - `title_keywords`: 文章标题关键词（可选，只抓取标题包含关键词的文章）
    - `match_mode`: 匹配模式（fuzzy/exact/regex，默认fuzzy）
    - `date_range`: 日期范围（可选，只抓取指定日期范围内的文章）

### 7.4 分类管理API
- `GET /api/categories` - 获取分类列表
- `POST /api/categories` - 创建分类
- `PUT /api/categories/:id` - 更新分类
- `DELETE /api/categories/:id` - 删除分类

### 7.5 文章管理API
- `GET /api/articles` - 获取文章列表（支持多维度筛选、排序、分页）
  - 查询参数：
    - `author`: 作者名称（支持模糊匹配）
    - `account_name`: 公众号名称（支持模糊匹配）
    - `title`: 文章标题（支持模糊匹配）
    - `category_id`: 分类ID
    - `read_status`: 阅读状态（read/unread/all）
    - `is_favorite`: 是否收藏（true/false）
    - `start_date`: 开始日期
    - `end_date`: 结束日期
    - `sort_by`: 排序字段（publish_time/created_at/title）
    - `sort_order`: 排序方向（asc/desc）
    - `page`: 页码
    - `page_size`: 每页数量
- `GET /api/articles/:id` - 获取文章详情
- `PUT /api/articles/:id/read` - 标记已读/未读
- `PUT /api/articles/:id/favorite` - 收藏/取消收藏
- `PUT /api/articles/:id/progress` - 更新阅读进度
- `DELETE /api/articles/:id` - 删除文章
- `GET /api/articles/search` - 多维度搜索文章
  - 查询参数：
    - `keyword`: 搜索关键词（全文搜索）
    - `author`: 作者名称
    - `account_name`: 公众号名称
    - `title`: 文章标题
    - `content`: 文章内容
    - `match_mode`: 匹配模式（fuzzy/exact/regex）
    - `category_id`: 分类ID
    - `start_date`: 开始日期
    - `end_date`: 结束日期
    - `sort_by`: 排序字段
    - `sort_order`: 排序方向
    - `page`: 页码
    - `page_size`: 每页数量

### 7.9 抓取任务API
- `GET /api/fetch-tasks` - 获取抓取任务列表
- `GET /api/fetch-tasks/:id` - 获取任务详情
- `POST /api/fetch-tasks` - 创建抓取任务
  - 请求参数：
    - `account_id`: 公众号ID（可选，单个公众号）
    - `account_ids`: 公众号ID列表（可选，批量公众号）
    - `account_name`: 公众号名称（可选，按名称过滤）
    - `author`: 作者名称（可选，只抓取指定作者的文章）
    - `title_keywords`: 文章标题关键词（可选，只抓取标题包含关键词的文章）
    - `match_mode`: 匹配模式（fuzzy/exact/regex，默认fuzzy）
    - `date_range`: 日期范围（可选，只抓取指定日期范围内的文章）
    - `fetch_method`: 抓取方式（rss/crawl/api，默认crawl）
    - `incremental`: 是否增量抓取（默认true）

### 7.10 统计API
- `GET /api/statistics/overview` - 获取统计概览
- `GET /api/statistics/categories` - 获取分类统计
- `GET /api/statistics/reading` - 获取阅读统计

### 7.11 设置API
- `GET /api/settings` - 获取用户设置
- `PUT /api/settings` - 更新用户设置

### 7.12 扣子平台API（后续扩展）
- `POST /api/coze/analyze` - 文章智能分析
- `POST /api/coze/summarize` - 文章摘要生成
- `POST /api/coze/categorize` - 智能分类推荐
- `POST /api/coze/extract` - 内容智能提取
- `GET /api/coze/status` - 获取API调用状态

## 八、风险与挑战

### 8.1 技术风险
- **反爬虫机制：** 公众号可能采取反爬虫措施
  - 应对：使用代理池、请求头伪装、降低抓取频率
- **数据量增长：** 文章数据可能快速增长
  - 应对：数据归档策略、定期清理旧数据
- **抓取稳定性：** 网络波动可能导致抓取失败
  - 应对：重试机制、错误日志、通知机制

### 8.2 合规风险
- **版权问题：** 抓取公众号文章可能涉及版权
  - 应对：仅个人使用，不对外传播，尊重原作者权益
- **服务条款：** 可能违反微信服务条款
  - 应对：仅用于个人学习研究，不商业化
- **用户数据保护：** 需要遵守数据保护法规
  - 应对：用户隐私协议、数据加密存储、GDPR合规（如需要）

### 8.3 功能风险
- **RSS支持有限：** 很多公众号不支持RSS
  - 应对：主要依赖爬虫方案，RSS作为补充
- **文章格式多样：** 不同公众号文章格式可能不同
  - 应对：灵活的解析规则，支持自定义解析器

## 九、后续优化方向

### 9.1 功能扩展
- [ ] 文章标签系统
- [ ] 文章评论功能
- [ ] 文章推荐功能
- [ ] 移动端APP
- [ ] 浏览器插件
- [ ] **扣子平台API对接**
  - [ ] 对接扣子平台API（智能分析、内容生成等）
  - [ ] 文章智能摘要生成
  - [ ] 文章分类智能推荐
  - [ ] 内容智能提取和结构化
  - [ ] 基于AI的阅读推荐

### 9.2 性能优化
- [ ] 文章内容全文搜索优化
- [ ] 图片CDN加速
- [ ] 数据缓存策略优化
- [ ] 数据库查询优化

### 9.3 用户体验优化
- [ ] 个性化推荐
- [ ] 阅读习惯分析
- [ ] 智能分类建议
- [ ] 快捷键支持

## 十、项目交付清单

### 10.1 代码交付
- [ ] 前端代码（React 18 + Ant Design项目）
- [ ] 后端代码（Python + FastAPI项目）
- [ ] 数据库脚本（PostgreSQL）
- [ ] Docker配置文件
- [ ] 部署脚本
- [ ] 依赖管理文件
  - [ ] 前端：package.json（npm/yarn/pnpm）
  - [ ] 后端：requirements.txt / poetry.lock（Python依赖管理，推荐使用 poetry）

### 10.2 文档交付
- [ ] 需求文档（本文档）
- [ ] 技术设计文档
- [ ] API文档
- [ ] 数据库设计文档
- [ ] 部署文档
- [ ] 用户使用手册

### 10.3 测试交付
- [ ] 单元测试用例
- [ ] 集成测试用例
- [ ] 测试报告

---

**文档版本：** v1.0  
**创建日期：** 2024年  
**最后更新：** 2024年
